# Problema 5 - RMI
* **Compilar**  utilizando o shell na pasta com os códigos:
```shell
javac *.java
```
* Gerar os **Stubs** para comunicação remota (A flag -keep serve para gerar o código do Stub)
```shell
rmic -keep CalculosNatacao
```
* Em um shell separado inicie o **Servidor**
```shell
java -Djava.security.policy=server.policy Server
```
* Em um shell separado inicie o **Cliente**
```shell
java -Djava.security.policy=server.policy Client
```

## Explicação do Código

* Para usar o RMI, é necessário definir uma **interface remota**, que define os métodos que podem ser invocados remotamente. No caso do problema 5, a interface contem apenas um método, _calculaCategoriaNadador(int idade)_, que recebe a idade e retorna a categoria do nadador:
```java
import  java.rmi.Remote;
import  java.rmi.RemoteException;

public  interface  Interface  extends  Remote {
	String  calculaCategoriaNadador(int  idade) throws  RemoteException;
}
```
* Em seguida, é necessário implementar uma **classe** que implementa essa **interface remota**. Essa classe representa o objeto remoto que pode ser acessado por outros componentes distribuídos. No caso do Problema 5, a classe é a seguinte:
```java
import  java.rmi.server.UnicastRemoteObject;
import  java.rmi.RemoteException;

public  class  CalculosNatacao  extends  UnicastRemoteObject  implements  Interface {
	public  CalculosNatacao() throws  RemoteException {}
	public  String  calculaCategoriaNadador(int  idade) throws  RemoteException {
		if(idade  <  5) {
			return  "Sem categoria";
		} else  if(idade  <=  7) {
			return  "Infantil A";
		} else  if(idade  <=  10) {
			return  "Infantil B";
		} else  if(idade  <=  13) {
			return  "Juvenil A";
		} else  if(idade  <=  17) {
			return  "Juvenil B";
		} else {
			return  "Adulto";
		}
	}
}
```
* Em seguida, temos que criar uma classe para iniciar o **Servidor RMI**. 
```java
import  java.rmi.Naming;
import  java.rmi.registry.LocateRegistry;

public  class  Server {
	public  static  void  main(String[] args) {
		try {
			Interface  calc  =  new  CalculosNatacao();
			String  objName  =  "rmi://localhost/Calc";
			System.out.println("Registrando o objeto no RMIRegistry...");
			LocateRegistry.createRegistry(1099);
			Naming.rebind(objName, calc);
			System.out.println("Aguardando clientes");
		} catch(Exception  e) {
			e.printStackTrace();
		}
	}
}
``` 
Perceba que o RMI também fornece mecanismos para **localizar** e **registrar** objetos remotos. 
```java
LocateRegistry.createRegistry(1099); // Cria um registro na porta 1099: 
```
```java
Naming.rebind(objName, calc); // Registra o objeto remoto calc
```
* Por fim, criamos uma classe cliente que se conecta ao objeto remoto. Esse cliente deve **localizar** o objeto remoto afim de utilizar suas funções. 
```java
import  java.rmi.Naming;
import  java.util.Scanner;

public  class  Client {
	public  static  void  main(String[] args) throws  Exception {
		String  objName  =  "rmi://localhost:1099/Calc";
		Interface  calc  = (Interface) Naming.lookup(objName);
		Scanner  keyboard  =  new  Scanner(System.in);
		System.out.println("Digite a idade do nadador!");
		System.out.println("A categoria do nadador é: "  + calc.calculaCategoriaNadador(keyboard.nextInt()));
		keyboard.close();
	}
}
```
```java
Interface calc  =  (Interface) Naming.lookup(objName); // Localiza o objeto remoto
```
* A partir daqui o cliente consegue utilizar os métodos do Objeto Remoto como se fossem locais.

## Resultado

* Rodando o Servidor
```shell
luan@pop-os:~/Equipe-05/RMI/5$ java -Djava.security.policy=server.policy Server
Registrando o objeto no RMIRegistry...
Aguardando clientes
```

* Rodando o Cliente
```shell
luan@pop-os:~/Equipe-05/RMI/5$ java -Djava.security.policy=server.policy Client
Digite a idade do nadador!
16
A categoria do nadador é: Juvenil B
```
```shell
luan@pop-os:~/Equipe-05/RMI/5$ java -Djava.security.policy=server.policy Client
Digite a idade do nadador!
25
A categoria do nadador é: Adulto
```

## Código Stub

* Ao utilizar a flag _-keep_ no seguinte comando, podemos ver o código do Stub:
```shell
rmic -keep CalculosNatacao
```
* O código fica da seguinte forma:
```java
// Stub class generated by rmic, do not edit.
// Contents subject to change without notice.

public  final  class  CalculosNatacao_Stub extends  java.rmi.server.RemoteStub implements  Interface, java.rmi.Remote
{
	private  static  final  long  serialVersionUID  =  2;
	private  static  java.lang.reflect.Method  $method_calculaCategoriaNadador_0;
	
	static {
		try {
			$method_calculaCategoriaNadador_0  =  Interface.class.getMethod("calculaCategoriaNadador", new  java.lang.Class[] {int.class});
		} catch (java.lang.NoSuchMethodException  e) {
			throw  new  java.lang.NoSuchMethodError(
			"stub class initialization failed");
		}
	}
	// constructors
	public  CalculosNatacao_Stub(java.rmi.server.RemoteRef  ref) {
		super(ref);
	}
	// methods from remote interfaces
	// implementation of calculaCategoriaNadador(int)
	public  java.lang.String  calculaCategoriaNadador(int  $param_int_1)
		throws  java.rmi.RemoteException
		{
		try {
			Object  $result  =  ref.invoke(this, $method_calculaCategoriaNadador_0, new  java.lang.Object[] {new  java.lang.Integer($param_int_1)}, -6998692952777436958L);
			return ((java.lang.String) $result);
		} catch (java.lang.RuntimeException  e) {
			throw  e;
		} catch (java.rmi.RemoteException  e) {
			throw  e;
		} catch (java.lang.Exception  e) {
			throw  new  java.rmi.UnexpectedException("undeclared checked exception", e);
		}
	}
}
```